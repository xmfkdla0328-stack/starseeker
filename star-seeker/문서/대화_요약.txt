[Star Seeker 전투 시스템 개발 대화 요약]

1. 기획서 분석 및 전체 개발 계획 수립
2. 데이터 구조 설계 (캐릭터, 유닛, 타임라인, 행동 등)
3. 전투 UI 단계별 구현
   - 적군 진영(상단), 타임라인(중앙), 아군 진영(하단) 레이아웃
   - 타임라인 궤적/노드/유닛/잔상/개입 모드 구현
   - 예지 아이콘 위치 조정(상단→타임라인)
4. 컴포넌트 분리 및 리팩토링 (TimelineArea 등)
5. 개입 모드/스킬/하이라이트/CP 게이지 UI 구현
6. Git 동기화, 충돌 해결, 강제 푸시 등 협업 이슈 처리

진행 순서와 주요 결정사항, 구현 단계별 완료 여부를 중심으로 대화가 이루어졌음.








다음 단계 수행하기 전에, 고민이 있어.

캐릭터 속도가 각각 다르잖아. 그런데 한 번은 한 명 뿐인 적의 속도가 엄청 빨라. 그래서 적이 처음에 한번 공격, 아군의 제일 빠른 캐릭터가 그 다음 공격, 그 이후 다른 적인 보스의 속도가 너~무 빨라서, 다른 속도가 느린 캐릭터들보다 훨씬 빠르게 속도가 돌아서 세 번째에도 보스 몬스터 행동. 그 다음 아군 2, 3, 4가 행동하는 형태로 턴이 만들어진다면?

이런 상황까지 감안했을 때, 지그재그의 꼭짓점 갯수는... <한 싸이클>을 기준으로 짜는게 좋으려나? 그니까, 싸이클이라는 게...아군 캐릭터 네 명이 전부다 행동하기까지의 시간같은 건데. 그 싸이클 내에 각 캐릭터들이 획득한 턴을 다 합한뒤, 그 합대로 꼭짓점의 갯수가 생겨나는 형태여야 하지 않을까?

그리고 보스 몬스터 하나만 있는게 아니라, 적이 나올 수 있는 최대 인원수인 5명 기준일 때는 또 여기에 다섯 명의 몬스터 턴까지도 표시가 되어야 할 거아냐. 그치?

그러니 대충 한 싸이클, 같은 느낌의 특정 시간 내에서 각 캐릭터들이 획득한 턴의 갯수를 합해서, 그 합만큼 지그재그 선의 꼭짓점(노드?)이 생겨나야 할 것 같아. 그럼 지그재그 선도 각 상황 별로 다르게 그려져야겠고...

이건 지금 당장 다뤄야 하나? 아니면 나중에 다뤄야 하나?


=>

지금: 궤적/노드 UI 기본 구조(고정)로 작업
전투 시스템 완성 후:
 - 실제 속도/턴/싸이클/유닛 수에 따라
 - 궤적/노드/위치/애니메이션을 동적으로 생성/연동


전체 계획표:
핵심 구조 설계 및 데이터 모델링
유닛(캐릭터/적) 데이터 구조 설계: HP, EP, CP, 속성, 직업, 장비, 위치(타임라인 거리) 등
타임라인(별자리 궤도) 구조 설계: 각 유닛의 위치, 이동, 도착(턴 획득) 로직
행동/스킬/개입(Intervention) 데이터 구조 설계: 일반 공격, 스킬, 필살기, 유저 개입 스킬
유저 개입 스킬(Intervention) 상수/데이터 구조화 및 관리 파일 생성 ← (신규 추가)
전투 화면 UI/UX 기본 구현
적군/아군 진영 배치 UI: 상단/하단 구역, 유닛 아이콘, 상태창
타임라인(별자리 궤도) UI: 궤적, 노드, 유닛 아이콘 이동, 잔상 효과
커맨드 패널/CP 게이지 UI: 행동 선택, CP 표시, 개입 버튼
타임라인 및 턴 연산 로직 구현
유닛 이동 공식: 매 틱마다 거리 차감, 도착 시 턴 획득
Pull/Push/Swap/Blackhole 등 개입 스킬 로직: 위치 조작, CP 소모/획득
턴 획득/행동 처리: 도착 유닛의 행동 선택 및 실행
타임라인 궤적/노드 개수·배치 동적 생성: 한 싸이클 내 유닛별 턴 분포(속도, 턴 획득 빈도)에 따라 궤적/노드 구조를 동적으로 생성/조정
유닛 행동 및 자원 시스템 구현
행동 선택(일반/스킬/필살기) 및 실행: EP/CP 획득, 쿨타임, 자원 소모
직업별 자원 수급 밸런스 적용: 패스파인더, 딜러, 탱커, 힐러 등
장비(모듈) 시스템 기본 적용: 슬롯, 옵션, 과부하 규칙
속성/상성 및 데미지/효과 명중, 효과 저항 공식 구현
속성/상성 판정 및 데미지 보너스: 엔트로피, 그래비티, 레조넌스 등
최종 스탯/명중률/저항 공식 적용
라운드/전투 흐름 및 상태 관리
라운드 전환/연속성 유지: 거리, CP 이관
전투 종료/승패 판정/보상 처리


(현재)
세부 계획표
상단(적군 진영) 구현
[완료] 1-1. 적군 진영 레이아웃 틀 생성 (상단 고정, 가로 배치)
[완료] 1-2. 적 유닛 아이콘/초상화 표시
[완료] 1-3. 적 유닛 HP/상태창 표시
[완료] 1-4. 예지 아이콘(다음 행동) 표시 → (삭제, 타임라인에서만 표시)
[완료] 1-5. 적군 전체 일러스트/초상화(앞모습) 공간 추가
 1-5-1. 적군 1명(보스): 중앙 상단에 크게 배치, 아이콘/상태창은 하단 또는 좌우에 소형 배치
 1-5-2. 적군 다수(2~5명): 각 적군별 일러스트 공간 분할(가로 배치), 아이콘/상태창은 각 일러스트 아래 배치, 크기 자동 조절

중앙(타임라인) 구현
[완료] 2-1. 타임라인 영역 레이아웃 틀 생성 (중앙 고정)
[완료] 2-2. 별자리 궤적(지그재그) 그래픽/노드 표시
[완료] 2-3. 유닛 아이콘/잔상 효과 구현 (궤적 위 이동)
[완료] 2-4. 타임라인 터치 시 개입 모드 활성화/비활성화 (시각적 구분)
[완료] 2-5 (new!) 타임라인 영역부터 별도 컴포넌트로 분리하는 리팩토링
[완료] 2-6. 개입 모드 시 유닛/노드 하이라이트 효과
[완료] 2-7. 개입 스킬(당기기/밀기/교환/블랙홀) 선택 UI/동작 구현
[완료] 2-7-1. [추가] 개입 스킬(Intervention) 정보 상수/데이터 파일 생성 및 관리
[완료] 2-7-2  [추가] 개임 스킬 ui 이름 스킬 명대로 변경
[완료] 2-8. CP 게이지(슬롯/잔량) 타임라인 우측 하단에 배치
  - CP 최대치 100(혹은 그 이상)으로 확장, 개입 스킬 소모량도 10/20/40 등으로 조정
  - 패스파인더 등 CP 수급 특화 직업의 전략적 가치가 드러나도록 설계
  - CP 수급/소모 밸런스는 실제 플레이/테스트를 통해 추가 조정
[완료] 2-9 예지 아이콘(다음 행동 예측)은 타임라인 위 유닛 아이콘과 함께 표시

---

※ 2단계 → 3단계 전 선결 과제 (세부 분할)

[완료] 2-10-1. [선결] 이미 존재하는 전투 전체 상태 구조/데이터 모델 점검 및 보완(필요시 확장)
[완료] 2-10-2. [선결] 전투 상태 Context API/Provider로 통합 관리 구조 구현
2-10-3. [선결] 타임라인/유닛/노드/예지/CP 등 실제 전투 데이터와 UI 연동 (더미 → 실제)
 [완료] 2-10-3-1. [타임라인] useBattleContext로 allies/enemy/battleState 등 실제 데이터 연동, position 기반 아이콘/잔상 위치 동적 렌더링, 도착/턴 획득 로직 UI 연동
 [완료] 2-10-3-1-1. [준비] TimelineArea 등 타임라인 관련 컴포넌트에서 useBattleContext 안전하게 import 및 더미/실제 데이터 병행 구조 준비
 [완료] 2-10-3-1-2. [연동1] allies/enemy/battleState 등 실제 전투 상태를 useBattleContext로 받아와서 기존 더미 데이터와 병행 렌더링(기본 UI 유지)
 [완료] 2-10-3-1-3. [연동2] position(거리) 기반 아이콘/잔상 위치만 실제 데이터로 교체, UI 정상 동작 확인
 [완료] 2-10-3-1-4. [연동3] 도착/턴 획득 등 타임라인 내 주요 로직만 실제 데이터로 교체, UI 정상 동작 및 에러 체크
 [완료] 2-10-3-1-5. [필수] 실제 데이터 세팅 구조 구현(BattleScreen에 partyData, enemyData 등 실제 전투 데이터 전달 및 세팅)
 [완료] 2-10-3-2. [유닛] (1) 적군 UI: useBattleContext로 유닛 정보/HP/CP/상태이상 등 실시간 반영, 사망/부활 등 상태 변화 UI 동기화
      (2) 아군 UI: 3단계에서 UI 구현 후 동일 방식으로 연동        
  [필수] 2-10-3-2-1. [Provider 구조 보장] BattleScreen, TimelineArea 등 전투 관련 주요 컴포넌트가 항상 BattleContext.Provider 하위에서 렌더링되도록 구조 점검 및 리팩토링
  - App.jsx, GameContextProvider.jsx 등에서 Provider 계층 구조 명확히 설계
  - 전투 진입/종료 시 컨텍스트 값이 올바르게 전달되는지 테스트
  - useBattleContext 경고/에러가 발생하지 않도록 실제 렌더링 경로 전수 점검
  - (필요시) 임시 fallback 제거, 컨텍스트 기반 상태 공유가 항상 동작하도록 보장
                                                                    // 3단계, 아군 관련 작업 후에 해야 한다고 함!!!
 [완료] 2-10-3-3. [노드] 한 싸이클 내 유닛별 턴 획득 빈도(속도 기반) 계산, 실제 획득 턴 수만큼 노드 동적 생성, 노드 위치/애니메이션 동기화
 [완료] 2-10-3-4. [예지] 다음 행동 유닛(예지) 정보 계산, 예지 아이콘을 타임라인 위 실제 위치에 표시
 2-10-3-5. [CP] 각 유닛의 currentCp(인과력) 값을 UI에 실시간 반영, CP 획득/소모 시 UI와 동기화
 2-10-3-6. [상태변화/이벤트] 턴 획득, 행동, 개입 스킬 사용 등 주요 이벤트 발생 시 UI 갱신, 전투 로그/애니메이션 등과 상태 변화 연동
2-10-4. [선결/선택] 타임라인 궤적/노드 동적 생성 로직 설계 및 적용
2-10-5. [선결/테스트] 각 UI(타임라인, 아군/적군 진영, 커맨드 등)와 상태 구조 연동 테스트 및 오류 점검
  - 위 작업 완료 후 3단계(아군 진영/커맨드 패널)로 진입

하단(아군 진영/커맨드 패널) 구현
3-1. 아군 진영 레이아웃 틀 생성 (하단 고정, 가로 배치)
3-2. 아군 유닛 아이콘/상태창/스킬창과 붙어서 표시 (얼굴 아이콘)
3-3. 아군 유닛 HP/상태창 표시
3-4. 커맨드 패널(행동 선택 버튼: 일반/스킬/필살기) 구현
3-5. 아군 전체 일러스트/초상화(뒷모습) 공간 추가
 3-5-1. 아군 1명: 하단 중앙에 크게 배치, 아이콘/상태창/스킬창은 하단 또는 좌우에 소형 배치
 3-5-2. 아군 다수(2~5명): 각 아군별 일러스트 공간 분할(가로 배치), 아이콘/상태창/스킬창은 각 일러스트 아래 배치, 뒷모습 포트레이트와 시각적 연결

UX/모바일 최적화
4-1. 전체 레이아웃 모바일 가로 모드 최적화
4-2. 터치 기반 조작 실수 방지(버튼 크기, 간격, 하이라이트 등)
4-3. 시각적 연결(타임라인-CP 게이지, 개입 모드 등) 디자인 적용
4-4. 일러스트 공간은 반응형(적/아군 수에 따라 자동 조절), 아이콘/상태창/스킬창은 일러스트와 시각적으로 연결